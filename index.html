<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peri√≥dico Estudiantil Marco Fidel Su√°rez</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Header con logo y nombre de la instituci√≥n -->
    <header class="header">
        <div class="container">
            <div class="logo-section">
                <img src="img/escudo.png" alt="Escudo Marco Fidel Su√°rez" class="logo-escudo">
                <div class="school-info">
                    <h1 class="school-name">Marco Fidel Su√°rez</h1>
                    <p class="newspaper-name">El Peri√≥dico Estudiantil</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Barra de Navegaci√≥n -->
    <nav class="navbar">
        <div class="nav">
            <a href="#inicio" class="nav-link active">Inicio</a>
            <a href="#sobre-nosotros" class="nav-link">Sobre Nosotros</a>
            <a href="#articulos" class="nav-link">Art√≠culos</a>
            <a href="#suscribirse" class="nav-link">Suscribirse</a>
        </div>
    </nav>

    <!-- Secci√≥n principal -->
    <main class="main">
        <div class="container">
            
            <!-- Secci√≥n de bienvenida -->
            <section id="inicio" class="welcome-section">
                <h2>Bienvenidos al peri√≥dico estudiantil</h2>
                <p>Mantente informado con las √∫ltimas noticias y eventos de nuestra escuela.</p>
            </section>

            <!-- Secci√≥n Sobre Nosotros -->
            <section id="sobre-nosotros" class="about-section">
                <h2>Sobre nosotros - Marco Fidel Su√°rez</h2>
                <div class="about-content">
                    <div class="about-text">
                        <p>
                            <strong>La Instituci√≥n Educativa Marco Fidel Su√°rez</strong> es un referente de excelencia 
                            acad√©mica en nuestra regi√≥n. Fundada hace m√°s de 60 a√±os, nuestra instituci√≥n ha formado 
                            generaciones de estudiantes comprometidos con el conocimiento, la justicia y el progreso social.
                        </p>
                        <p>
                            Nuestro nombre honra la memoria de <strong>Marco Fidel Su√°rez</strong>, ilustre colombiano, 
                            escritor, gram√°tico y expresidente de Colombia, quien representa los valores de esfuerzo, 
                            superaci√≥n y dedicaci√≥n al estudio que promovemos en nuestra comunidad educativa.
                        </p>
                        <p>
                            Nos caracterizamos por ofrecer una educaci√≥n integral que combina la excelencia acad√©mica 
                            con la formaci√≥n en valores, el desarrollo del pensamiento cr√≠tico y el compromiso con la 
                            comunidad. Nuestros estudiantes se destacan por su liderazgo, creatividad y responsabilidad social.
                        </p>
                        <p>
                            <strong>Misi√≥n:</strong> Formar ciudadanos √≠ntegros, cr√≠ticos y competentes, capaces de 
                            transformar su entorno y contribuir al desarrollo de una sociedad m√°s justa y equitativa.
                        </p>
                    </div>
                    <div class="about-stats">
                        <div class="stat-item">
                            <span class="stat-number">60+</span>
                            <span class="stat-label">A√±os de historia</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">1500+</span>
                            <span class="stat-label">Estudiantes</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">100+</span>
                            <span class="stat-label">Docentes</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n para crear art√≠culos (EJEMPLO COMPLETADO) -->
            <section id="crear-articulo" class="create-article-section">
                <h2>Publicar nuevo art√≠culo</h2>
                <form id="form-articulo" class="form-container">
                    <div class="form-group">
                        <label for="titulo">T√≠tulo del art√≠culo *</label>
                        <input 
                            type="text" 
                            id="titulo" 
                            name="titulo" 
                            placeholder="Ej: Inauguraci√≥n de la nueva biblioteca"
                            required>
                    </div>

                    <div class="form-group">
                        <label for="autor-nombre">Nombre del autor *</label>
                        <input 
                            type="text" 
                            id="autor-nombre" 
                            name="autor-nombre" 
                            placeholder="Ej: Juan P√©rez"
                            required>
                    </div>

                    <div class="form-group">
                        <label for="autor-email">Correo del autor *</label>
                        <input 
                            type="email" 
                            id="autor-email" 
                            name="autor-email" 
                            placeholder="autor@colegio.edu"
                            required>
                    </div>

                    <div class="form-group">
                        <label for="banner">URL de la imagen (banner) *</label>
                        <input 
                            type="url" 
                            id="banner" 
                            name="banner" 
                            placeholder="https://ejemplo.com/imagen.jpg"
                            required>
                    </div>

                    <div class="form-group">
                        <label for="contenido">Contenido del art√≠culo *</label>
                        <textarea 
                            id="contenido" 
                            name="contenido" 
                            placeholder="Escribe el contenido completo del art√≠culo aqu√≠..."
                            required></textarea>
                    </div>

                    <button type="submit" class="btn">Publicar art√≠culo</button>
                </form>
            </section>

            <!-- Secci√≥n de art√≠culos publicados -->
            <section id="articulos" class="articles-section">
                <h2>Art√≠culos publicados</h2>
                <div id="articulos-container" class="articles-grid">
                    <p style="text-align: center; color: #666; grid-column: 1/-1;">‚è≥ Cargando art√≠culos...</p>
                </div>
            </section>

            <!-- Secci√≥n de suscripci√≥n (EJEMPLO COMPLETADO) -->
            <section id="suscribirse" class="subscription-section">
                <h2>Suscr√≠bete a nuestro bolet√≠n</h2>
                <p>Recibe notificaciones por email cada vez que publiquemos un nuevo art√≠culo.</p>
                <form id="form-suscripcion" class="form-container">
                    <div class="form-group">
                        <label for="nombre-suscriptor">Nombre completo *</label>
                        <input 
                            type="text" 
                            id="nombre-suscriptor" 
                            name="nombre" 
                            placeholder="Ej: Juan P√©rez"
                            required>
                    </div>

                    <div class="form-group">
                        <label for="email-suscriptor">Correo electr√≥nico *</label>
                        <input 
                            type="email" 
                            id="email-suscriptor" 
                            name="email" 
                            placeholder="ejemplo@correo.com"
                            required>
                    </div>

                    <button type="submit" class="btn">Suscribirse</button>
                </form>
            </section>

        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 Peri√≥dico estudiantil. Todos los derechos reservados.</p>
        </div>
    </footer>

    <!-- Modal para art√≠culo completo -->
    <div id="modal-articulo" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="cerrarModal()">√ó</button>
            <img id="modal-banner" class="modal-banner" src="" alt="">
            <div class="modal-body">
                <h2 id="modal-titulo" class="modal-title"></h2>
                <span id="modal-fecha" class="modal-date"></span>
                <p id="modal-contenido" class="modal-text"></p>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <!-- EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <!-- Archivos del proyecto -->
    <script src="js/articulos.js"></script>
    <script src="js/suscriptores.js"></script>
    <script src="js/email.js"></script>
    <script src="js/modal.js"></script>
    <script src="js/publishers.js"></script>
    
    <!-- Script de ejemplo completado -->
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ P√°gina cargada - EJEMPLO COMPLETADO');
            
            // Cargar art√≠culos desde Firebase
            await cargarArticulos();
            
            // Navegaci√≥n suave
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remover clase active de todos
                    navLinks.forEach(l => l.classList.remove('active'));
                    
                    // Agregar clase active al clickeado
                    this.classList.add('active');
                    
                    // Scroll suave a la secci√≥n
                    const targetId = this.getAttribute('href').substring(1);
                    const targetSection = document.getElementById(targetId);
                    if (targetSection) {
                        targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                });
            });
            
            // Formulario de art√≠culos
            const formArticulo = document.getElementById('form-articulo');
            formArticulo.addEventListener('submit', async function(evento) {
                evento.preventDefault();
                
                const titulo = document.getElementById('titulo').value;
                const autorNombre = document.getElementById('autor-nombre').value;
                const autorEmail = document.getElementById('autor-email').value;
                const banner = document.getElementById('banner').value;
                const contenido = document.getElementById('contenido').value;
                
                if (!titulo || !autorNombre || !autorEmail || !banner || !contenido) {
                    alert('Por favor completa todos los campos');
                    return;
                }

                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(autorEmail)) {
                    alert('Por favor ingresa un email v√°lido para el autor');
                    return;
                }

                const esValido = await esPublisherValido(autorEmail);
                if (!esValido) {
                    alert('Este correo no est√° autorizado para publicar art√≠culos.');
                    return;
                }
                
                const articulo = { titulo, banner, contenido, autorNombre, autorEmail };
                
                const guardado = await guardarArticulo(articulo);
                if (guardado) {
                    // Notificar a los suscriptores (antes del alert para ver los logs)
                    const resultado = await notificarSuscriptores(articulo);
                    
                    if (resultado.enviados > 0) {
                        alert(`¬°Art√≠culo publicado! Se notific√≥ a ${resultado.enviados} suscriptor(es).`);
                    } else {
                        alert('¬°Art√≠culo publicado exitosamente!');
                    }
                    
                    formArticulo.reset();
                    location.reload(); // Recargar para ver el nuevo art√≠culo
                } else {
                    alert('Error al publicar el art√≠culo. Revisa la consola.');
                }
            });
            
            // Formulario de suscripci√≥n
            const formSuscripcion = document.getElementById('form-suscripcion');
            formSuscripcion.addEventListener('submit', async function(evento) {
                evento.preventDefault();
                
                const nombre = document.getElementById('nombre-suscriptor').value;
                const email = document.getElementById('email-suscriptor').value;
                
                if (!nombre || !email) {
                    alert('Por favor completa todos los campos');
                    return;
                }
                
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    alert('Por favor ingresa un email v√°lido');
                    return;
                }
                
                const suscriptor = { nombre, email };
                
                const guardado = await guardarSuscriptor(suscriptor);
                if (guardado) {
                    alert('¬°Suscripci√≥n exitosa! Recibir√°s notificaciones de nuevos art√≠culos.');
                    formSuscripcion.reset();
                } else {
                    alert('Error: Este email ya est√° suscrito o es inv√°lido');
                }
            });
            
            // Funci√≥n para cargar art√≠culos desde Firebase
            async function cargarArticulos() {
                try {
                    const articulos = await obtenerArticulos();
                    const container = document.getElementById('articulos-container');
                    
                    if (articulos.length === 0) {
                        container.innerHTML = '<p style="text-align: center; color: #666;">No hay art√≠culos publicados a√∫n.</p>';
                        return;
                    }
                    
                    // Limpiar el contenedor
                    container.innerHTML = '';
                    
                    // Crear tarjeta para cada art√≠culo
                    articulos.forEach(articulo => {
                        const card = document.createElement('div');
                        card.className = 'article-card';
                        card.setAttribute('data-articulo', JSON.stringify(articulo));

                        const autorLinea = articulo.autorNombre 
                            ? ` ¬∑ ‚úç ${articulo.autorNombre}` 
                            : '';
                        
                        card.innerHTML = `
                            <img src="${articulo.banner}" 
                                 alt="${articulo.titulo}" 
                                 class="article-banner"
                                 onerror="this.style.display='none'">
                            <div class="article-content">
                                <h3>${articulo.titulo}</h3>
                                <p class="article-date">üìÖ ${articulo.fecha || 'Fecha no disponible'}${autorLinea}</p>
                                <p>${articulo.contenido.substring(0, 150)}...</p>
                            </div>
                        `;
                        
                        // Agregar evento click para abrir modal
                        card.addEventListener('click', function() {
                            abrirModal(articulo);
                        });
                        
                        container.appendChild(card);
                    });
                    
                    console.log(`‚úÖ ${articulos.length} art√≠culos cargados`);
                    
                } catch (error) {
                    console.error('‚ùå Error al cargar art√≠culos:', error);
                }
            }
        });
    </script>
</body>
</html>
